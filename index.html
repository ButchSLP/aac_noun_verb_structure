<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AAC Noun + Verb - Audio Updated</title>
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <style>
        html, body { 
		height: 100%;
		margin: 0;
		padding: 0;
		overflow: hidden;
		background: #f0f2f5;
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		touch-action: none;
	}

        body {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: 10px;
		box-sizing: border-box;
		position: relative;
	}

        #fullscreen-btn {
		position: absolute;
		top: 10px;
		right: 10px;
		padding: 8px 15px;
		font-size: 0.8rem;
		background: #34495e;
		color: white;
		border-radius: 5px;
		z-index: 100;
	}

        #game-container, #result-screen {
		width: 95%;
		max-width: 900px;
		height: 92vh;
		background: white;
		padding: 20px;
		border-radius: 20px;
		box-shadow: 0 10px 25px rgba(0,0,0,0.1);
		display: flex;
		flex-direction: column;
		box-sizing: border-box;
		position: relative;
	}

        #stats-header {
		display: flex;
		justify-content: space-between;
		margin-bottom: 10px;
		font-weight: bold;
		background: #f8f9fa;
		padding: 10px;
		border-radius: 10px;
		flex-shrink: 0;
	}

        #gif-container {
		flex-grow: 1;
		background: #eee;
		border-radius: 15px;
		margin-bottom: 10px;
		display: flex;
		align-items: center;
		justify-content: center;
		border: 2px solid #ddd;
		overflow: hidden;
		min-height: 0;
	}

        #trial-gif {
		max-width: 100%;
		max-height: 100%;
		object-fit: contain;
	}

        #drop-zone {
		flex-shrink: 0;
		display: flex;
		gap: 15px;
		padding: 15px;
		background: #fff;
		border: 3px dashed #3498db;
		min-height: 155px;
		margin-bottom: 10px;
		border-radius: 15px;
		justify-content: center;
		align-items: center;
	}

        .bank {
		flex-shrink: 0;
		display: flex;
		gap: 12px;
		justify-content: center;
		flex-wrap: wrap;
		padding: 15px;
		background: #f9f9f9;
		border-radius: 10px;
		border: 2px solid #eee;
		min-height: 150px;
	}

        .symbol {
		padding: 10px;
 		border-radius: 12px;
		cursor: grab;
		font-weight: bold;
		width: 140px;
		min-height: 120px;
		font-size: 1rem;
		box-shadow: 0 4px 6px rgba(0,0,0,0.1);
		text-align: center;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		box-sizing: border-box;
		/* Essential for mobile interaction */
		user-select: none;
		-webkit-user-drag: element;
	}

        .symbol img {
		width: 60px;
		height: 60px;
		object-fit: contain;
		margin-bottom: 8px;
		pointer-events: none;
	}

        .who { background: #E0E0E0; border: 4px solid #FFFF00; } 
        .doing { background: #E0E0E0; border: 4px solid #2ECC71; } 
        .dragging { opacity: 0.3; }

        button {
		flex-shrink: 0;
		padding: 12px 35px;
		font-size: 1rem;
		cursor: pointer;
		border-radius: 50px;
		border: none;
		font-weight: bold;
		transition: 0.3s;
	}

        #check-btn { background: #3498db; color: white; margin-top: 5px; }
        #next-btn { background: #2ecc71; color: white; display: none; margin: 5px auto; }

        #feedback {
		flex-shrink: 0;
		margin-top: 5px;
		font-weight: bold;
		font-size: 1.2rem; height: 25px;
	}

        #celebration-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(255, 255, 255, 0.95);
		z-index: 2000;
		display: none;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		text-align: center; pointer-events: none;
	}

        #celebration-gif {
		max-width: 80%;
		max-height: 60%;
		border-radius: 20px;
	}

        .celebration-text {
		font-size: 2.5rem;
		color: #2ecc71;
		font-weight: bold;
		margin-bottom: 20px;
	}

        #log-container {
		flex-grow: 1;
		overflow-y: auto;
		margin-top: 10px;
	 }

        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 0.9rem; }
        th { background-color: #f2f2f2; position: sticky; top: 0; }

        .pass { color: #27ae60; font-weight: bold; }
        .fail { color: #e74c3c; font-weight: bold; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <button id="fullscreen-btn" onclick="toggleFullScreen()">⛶ Full Screen</button>

    <div id="celebration-overlay">
        <div class="celebration-text">Amazing Job!</div>
        <img id="celebration-gif" src="images/dancing_cartoon.gif" alt="Celebration!">
    </div>

    <div id="game-container">
        <div id="stats-header">
            <span>Trial: <span id="current-trial">1</span> / 10</span>
            <span>Score: <span id="score-val">0</span></span>
        </div>
        <div id="gif-container"><img id="trial-gif" src="" alt="Loading GIF..."></div>
        <div id="drop-zone"></div>
        <div class="bank" id="word-bank"></div>
        <div id="feedback"></div>
        <button id="check-btn" onclick="checkAnswer()">Check Answer</button>
        <button id="next-btn" onclick="nextTrial()">Next Trial &rarr;</button>
    </div>

    <div id="result-screen" class="hidden">
        <h1 style="margin: 0; color: #2c3e50; font-size: 1.5rem;">Results Summary</h1>
        <div style="font-size: 3rem; color: #3498db;" id="final-pct">0%</div>
        <div id="log-container">
            <table>
                <thead><tr><th>Trial</th><th>Sentence</th><th>Result</th></tr></thead>
                <tbody id="log-body"></tbody>
            </table>
        </div>
        <button onclick="location.reload()" style="background:#34495e; color:white; margin-top: 10px;">Restart</button>
    </div>

    <script>
        // --- AUDIO PRE-LOADING ---
        const dropSound = new Audio('sounds/drop.mp3');
        dropSound.volume = 0.3; // Volume set to 30% (softer)

        const celebrationSong = new Audio('sounds/celebration_song.mp3');

        function toggleFullScreen() {
            if (!document.fullscreenElement) { document.documentElement.requestFullscreen(); document.getElementById('fullscreen-btn').innerText = "Exit Full Screen"; } 
            else { document.exitFullscreen(); document.getElementById('fullscreen-btn').innerText = "⛶ Full Screen"; }
        }

        const trialsData = [
             { gif: "images/dog_smelling.gif", correctWho: "The dog", whoImg: "symbols/dog.png", correctDoing: "is smelling", doingImg: "symbols/smell.png", distWho: "The cat", distWhoImg: "symbols/cat.png", distDoing: "is sleeping", distDoingImg: "symbols/sleep.png" },
             { gif: "images/girl_running.gif", correctWho: "The girl", whoImg: "symbols/girl.png", correctDoing: "is running", doingImg: "symbols/run.png", distWho: "The boy", distWhoImg: "symbols/boy.png", distDoing: "is eating", distDoingImg: "symbols/eat.png" },
             { gif: "images/cat_jumping.gif", correctWho: "The cat", whoImg: "symbols/cat.png", correctDoing: "is jumping", doingImg: "symbols/jump.png", distWho: "The bird", distWhoImg: "symbols/bird.png", distDoing: "is flying", distDoingImg: "symbols/fly.png" },
             { gif: "images/boy_eating.gif", correctWho: "The boy", whoImg: "symbols/boy.png", correctDoing: "is eating", doingImg: "symbols/eat.png", distWho: "The teacher", distWhoImg: "symbols/teacher.png", distDoing: "is writing", distDoingImg: "symbols/write.png" },
             { gif: "images/baby_crying.gif", correctWho: "The baby", whoImg: "symbols/baby.png", correctDoing: "is crying", doingImg: "symbols/cry.png", distWho: "The man", distWhoImg: "symbols/man.png", distDoing: "is washing", distDoingImg: "symbols/wash.png" },
             { gif: "images/bird_flying.gif", correctWho: "The bird", whoImg: "symbols/bird.png", correctDoing: "is flying", doingImg: "symbols/fly.png", distWho: "The dog", distWhoImg: "symbols/dog.png", distDoing: "is talking", distDoingImg: "symbols/talk.png" },
             { gif: "images/fish_looking.gif", correctWho: "The fish", whoImg: "symbols/fish.png", correctDoing: "is looking", doingImg: "symbols/look.png", distWho: "The octopus", distWhoImg: "symbols/octopus.png", distDoing: "is dancing", distDoingImg: "symbols/dance.png" },
             { gif: "images/man_cutting.gif", correctWho: "The man", whoImg: "symbols/man.png", correctDoing: "is cutting", doingImg: "symbols/cut.png", distWho: "The woman", distWhoImg: "symbols/woman.png", distDoing: "is holding", distDoingImg: "symbols/hold.png" },
             { gif: "images/man_washing.gif", correctWho: "The man", whoImg: "symbols/man.png", correctDoing: "is washing", doingImg: "symbols/wash.png", distWho: "The baby", distWhoImg: "symbols/baby.png", distDoing: "is crying", distDoingImg: "symbols/cry.png" },
             { gif: "images/girl_reading.gif", correctWho: "The girl", whoImg: "symbols/girl.png", correctDoing: "is reading", doingImg: "symbols/read.png", distWho: "The cat", distWhoImg: "symbols/cat.png", distDoing: "is flying", distDoingImg: "symbols/fly.png" }
        ];

        let currentIndex = 0;
        let score = 0;
        let trialLog = [];

        function loadTrial() {
            const trial = trialsData[currentIndex];
            document.getElementById('current-trial').innerText = currentIndex + 1;
            document.getElementById('trial-gif').src = trial.gif;
            document.getElementById('drop-zone').innerHTML = "";
            document.getElementById('feedback').innerText = "";
            document.getElementById('check-btn').style.display = "inline-block";
            document.getElementById('next-btn').style.display = "none";
            const bank = document.getElementById('word-bank');
            bank.innerHTML = "";
            const items = [{ text: trial.correctWho, type: "who", img: trial.whoImg }, { text: trial.correctDoing, type: "doing", img: trial.doingImg }, { text: trial.distWho, type: "who", img: trial.distWhoImg }, { text: trial.distDoing, type: "doing", img: trial.distDoingImg }].sort(() => Math.random() - 0.5);
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = `symbol ${item.type}`;
                div.draggable = true;
                div.dataset.type = item.type;
                div.dataset.text = item.text;
                const img = document.createElement('img');
                img.src = item.img;
                div.appendChild(img);
                const textNode = document.createElement('span');
                textNode.innerText = item.text;
                div.appendChild(textNode);
                div.addEventListener('dragstart', (e) => e.target.classList.add('dragging'));
                div.addEventListener('dragend', (e) => e.target.classList.remove('dragging'));
                bank.appendChild(div);
            });
        }

        const dropZone = document.getElementById('drop-zone');
        const wordBank = document.getElementById('word-bank');

        [dropZone, wordBank].forEach(zone => {
            zone.addEventListener('dragover', e => e.preventDefault());
            zone.addEventListener('drop', e => {
                const dragging = document.querySelector('.dragging');
                if (dragging) {
                    zone.appendChild(dragging);
                    dragging.classList.remove('dragging');
                    if(zone.id === "drop-zone") {
                        dropSound.currentTime = 0; 
                        dropSound.play();
                    }
                }
            });
        });

        function checkAnswer() {
            const placed = Array.from(dropZone.children);
            const trial = trialsData[currentIndex];
            if (placed.length < 2) { document.getElementById('feedback').innerText = "Drag both parts!"; return; }
            const isCorrect = placed[0].dataset.type === 'who' && placed[1].dataset.type === 'doing' && placed[0].dataset.text === trial.correctWho && placed[1].dataset.text === trial.correctDoing;
            trialLog.push({ trialNum: currentIndex + 1, sentence: `${trial.correctWho} ${trial.correctDoing}`, status: isCorrect ? "Pass" : "Fail" });
            if (isCorrect) { document.getElementById('feedback').innerText = "✔ Correct!"; document.getElementById('feedback').style.color = "#2ecc71"; score++; document.getElementById('score-val').innerText = score; } 
            else { document.getElementById('feedback').innerText = "✘ Incorrect"; document.getElementById('feedback').style.color = "#e74c3c"; }
            document.getElementById('check-btn').style.display = "none";
            document.getElementById('next-btn').style.display = "inline-block";
        }

        function nextTrial() { currentIndex++; if (currentIndex < 10) { loadTrial(); } else { showResults(); } }

        function showResults() {
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('final-pct').innerText = (score / 10 * 100) + "%";
            
            const logBody = document.getElementById('log-body');
            trialLog.forEach(item => {
                const row = `<tr><td>${item.trialNum}</td><td>${item.sentence}</td><td class="${item.status.toLowerCase()}">${item.status}</td></tr>`;
                logBody.innerHTML += row;
            });

            if (score >= 8) {
                const overlay = document.getElementById('celebration-overlay');
                overlay.style.display = 'flex';
                
                // Celebration song starts and stays playing
                celebrationSong.currentTime = 0;
                celebrationSong.play();

                setTimeout(() => {
                    overlay.style.opacity = '0';
                    overlay.style.transition = 'opacity 1s';
                    setTimeout(() => { 
                        overlay.style.display = 'none'; 
                        // Note: celebrationSong.pause() is removed so it continues playing
                    }, 1000);
                }, 5000);
            }
        }

        loadTrial();
    </script>
</body>
</html>
